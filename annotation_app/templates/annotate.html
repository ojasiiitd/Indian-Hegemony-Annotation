{% extends "layout/base.html" %}

{% block content %}

<h1 class="title">Annotation Task</h1>
<p class="subtitle">
This task evaluates cultural hegemony in LLM-generated responses across Indian States.
</p>

<form method="POST">

  <!-- REGION / STATE -->
  {% include "components/region_state.html" %}

  <hr>

  <!-- PROMPTS (SHARED ACROSS MODELS) -->
  <div class="columns is-variable is-6">
    <div class="column">
      <label class="label">Base Prompt</label>
      <textarea class="textarea"
                name="base_prompt"
                rows="3"
                required>{{ draft.prompts.base if draft }}</textarea>
    </div>

    <div class="column">
      <label class="label">Identity-Primed Prompt</label>
      <textarea class="textarea"
                name="identity_primed_prompt"
                rows="3"
                required>{{ draft.prompts.identity if draft }}</textarea>
    </div>
  </div>

  <hr>

  {% set models = [
    {"key": "gemini", "js": "gemini",  "label": "Model 1"},
    {"key": "gpt",    "js": "gpt", "label": "Model 2"},
    {"key": "llama",  "js": "llama",   "label": "Model 3"},
    {"key": "deepseek",  "js": "deepseek",   "label": "Model 4"}
  ] %}

  <!-- MODELS LOOP -->
  {% for m in models %}
    <h2 class="title is-4">{{ m.label }}</h2>

    <div class="notification is-danger is-light mb-4" style="margin-top:-0.75rem;">
      <strong>IMPORTANT NOTE:</strong>
      Please check your prompt and use the <em>Generate</em> button <b>only once</b> per model per annotation to ensure no credits are wasted.
    </div>

    <div class="columns is-variable is-6">

      {% for kind in ["base", "identity"] %}
      <div class="column">

        <button id="{{ m }}_generate_btn"
                type="button"
                class="button is-dark mb-3"
                onclick="generateOutput('{{ m.js }}','{{ kind }}')">
          Generate
        </button>

        <textarea class="textarea"
                  id="{{ m.js }}_llm_output_{{ kind }}"
                  name="{{ m.key }}_{{ kind }}_output"
                  rows="20"
                  readonly>
{{ draft.outputs[m.key][kind].text if draft }}
        </textarea>

        {% with model=m.key, kind=kind %}
          {% include "components/hegemony_axes.html" %}
        {% endwith %}

      </div>
      {% endfor %}

    </div>

  <!-- GROUND TRUTH -->
  <div class="field">
    <label class="label">Ground Truth (100–200 words)</label>
    <textarea class="textarea"
              name="{{ m.js }}_ground_truth"
              rows="15"
              required>{{ draft.outputs[m.key].ground_truth if draft }}</textarea>
  </div>

    <hr>
  {% endfor %}

  <!-- REFERENCES -->
  <div class="field">
    <label class="label">References (links only)</label>
    <textarea class="textarea"
              name="references"
              rows="3">{{ draft.references if draft }}</textarea>
  </div>

  <!-- SUBMIT -->
  <div class="field has-text-right">
    <button class="button is-info is-medium" type="submit">
      Review Annotation →
    </button>
    <hr>
  </div>

</form>

{% endblock %}

{% block scripts %}
  {% include "scripts/annotate_scripts.html" %}
{% endblock %}