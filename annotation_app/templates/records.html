{% extends "layout/base.html" %}

{% block content %}

<h1 class="title">Collected Annotations</h1>
<p class="subtitle">
All submitted records (latest first).
</p>

{% if not records %}
  <p>No records yet.</p>
{% endif %}

{% for r in records %}
<div class="box">

  <!-- HEADER -->
  <div class="columns is-mobile">
    <div class="column">
      <strong>ID:</strong> {{ r.id }}<br>
      <strong>Region:</strong> {{ r.region }} — {{ r.state }}
    </div>
    <div class="column has-text-right">
      <small>{{ r.timestamp }}</small>
    </div>
  </div>

  <hr>

  <!-- PROMPTS -->
  <h3 class="has-text-weight-semibold">Prompts</h3>
  <div class="columns is-variable is-6">
    <div class="column">
      <strong>Base Prompt</strong>
      <pre class="wrapped-pre">{{ r.prompts.base }}</pre>
    </div>
    <div class="column">
      <strong>Identity-Primed Prompt</strong>
      <pre class="wrapped-pre">{{ r.prompts.identity }}</pre>
    </div>
  </div>

  <hr>

  <!-- MODEL OUTPUTS -->
  {% for model, model_data in r.outputs.items() %}
    {% set idx = loop.index %}
    <h3 class="has-text-weight-semibold">Model {{ idx }} Outputs</h3>

    <div class="columns is-variable is-6">

      {% for kind in ["base", "identity"] %}
      <div class="column">
        <strong>{{ kind|capitalize }} Prompt</strong>
        <pre class="wrapped-pre">{{ model_data[kind].text }}</pre>

        <ul>
          {% for axis, data in model_data[kind].hegemony.items() %}
            <li>
              {{ axis|capitalize }}: {{ data.present }}
              {% if data.impact is not none %}
                – {{ data.impact }}
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      </div>
      {% endfor %}

    </div>

    <hr>
  {% endfor %}

  <!-- GROUND TRUTH -->
  <h4 class="has-text-weight-semibold">Ground Truth</h4>
  <pre class="wrapped-pre">{{ r.ground_truth }}</pre>

  {% if r.references %}
    <h4 class="has-text-weight-semibold mt-3">References</h4>
    <pre class="wrapped-pre">{{ r.references }}</pre>
  {% endif %}

</div>
{% endfor %}

{% endblock %}