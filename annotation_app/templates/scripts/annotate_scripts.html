<script>
  const regionStateMap = {{ region_state_map | tojson }};

  function updateState() {
    const regionSelect = document.getElementById("region");
    const stateSelect = document.getElementById("state");

    const region = regionSelect.value;
    stateSelect.innerHTML = "";

    if (!region) {
      stateSelect.innerHTML = "<option value=''>Select state</option>";
      return;
    }

    const state = regionStateMap[region];
    const option = document.createElement("option");
    option.value = state;
    option.text = state;
    stateSelect.appendChild(option);
  }

  document.addEventListener("DOMContentLoaded", function () {
    {% if draft %}
      const region = "{{ draft.region }}";
      const state = "{{ draft.state }}";

      const regionSelect = document.getElementById("region");
      regionSelect.value = region;

      updateState();  // now safe

      document.getElementById("state").value = state;
    {% endif %}
  });
</script>



<script>
async function generateOutput(model, kind) {

  // 1. Read the correct prompt
  const prompt =
    kind === "base"
      ? document.querySelector("textarea[name='base_prompt']").value
      : document.querySelector("textarea[name='identity_primed_prompt']").value;

  if (!prompt.trim()) {
    alert("Prompt is empty");
    return;
  }

  // 2. Target the correct output textarea
  // IDs:
  // gemini_llm_output_base
  // gemini_llm_output_identity
  // chatgpt_llm_output_base
  // chatgpt_llm_output_identity
  const btn = document.getElementById(`${model}_${kind}_generate_btn`);
  const outputBox = document.getElementById(
    `${model}_llm_output_${kind}`
  );

  if (!outputBox) {
    alert("Output box not found in DOM.");
    return;
  }

  outputBox.value = "Generatingâ€¦";

  // 3. Call backend
  try {
    const response = await fetch(`/generate/${model}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ prompt })
    });

    const data = await response.json();

    if (data.error) {
      outputBox.value = "Error: " + data.error;
    } else {
      outputBox.value = data.text;
    }

  } catch (err) {
    console.error(err);
    outputBox.value = "Request failed.";
  }
}
</script>


<script>
let currentStep = 1;

function showStep(step) {
  document.querySelectorAll(".step").forEach(div => {
    div.classList.add("is-hidden");
  });

  const el = document.getElementById(`step-${step}`);
  if (el) {
    el.classList.remove("is-hidden");
    currentStep = step;
  }
}

function nextStep() {
  showStep(currentStep + 1);
}

function prevStep() {
  showStep(currentStep - 1);
}

// Optional: start at step 1 explicitly
document.addEventListener("DOMContentLoaded", () => {
  showStep(1);
});
</script>
